#include <algorithm>
#include <takisy/cgl/font/tfont_simple.h>

static unsigned char g_ascii_bitmap[][12] = {
    { 0x7b, 0x87, 0x87, 0x87, 0x87, 0x87, 0x87, 0x87, 0x87, 0x87, 0x87, 0x7b, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x10, 0x10, 0x10, 0x10, 0x10, },
    { 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x1c, 0x00, 0x00, 0x00, 0x00, 0x00, },
    { 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, },
    { 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x30, 0x78, 0x78, 0x78, 0x30, 0x00, 0x00, 0x00, 0x00, },
    { 0xfc, 0xfc, 0xfc, 0xcc, 0x84, 0x84, 0x84, 0xcc, 0xfc, 0xfc, 0xfc, 0xfc, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, },
    { 0x00, 0x1c, 0x0c, 0x0c, 0x14, 0x10, 0x30, 0x48, 0x48, 0x30, 0x00, 0x00, },
    { 0x00, 0x38, 0x44, 0x44, 0x38, 0x10, 0x7c, 0x10, 0x10, 0x10, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, },
    { 0x00, 0x0c, 0x34, 0x2c, 0x34, 0x24, 0x24, 0x2c, 0x6c, 0x60, 0x00, 0x00, },
    { 0x00, 0x54, 0x54, 0x28, 0x28, 0x6c, 0x28, 0x28, 0x54, 0x54, 0x00, 0x00, },
    { 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0xfc, 0x10, 0x10, 0x10, 0x10, 0x10, },
    { 0x00, 0x04, 0x0c, 0x1c, 0x3c, 0x7c, 0x3c, 0x1c, 0x0c, 0x04, 0x00, 0x00, },
    { 0x00, 0x10, 0x38, 0x10, 0x10, 0x10, 0x10, 0x10, 0x38, 0x10, 0x00, 0x00, },
    { 0x00, 0x28, 0x28, 0x28, 0x28, 0x28, 0x28, 0x00, 0x28, 0x28, 0x00, 0x00, },
    { 0x00, 0x3c, 0x54, 0x54, 0x54, 0x34, 0x14, 0x14, 0x14, 0x14, 0x3c, 0x00, },
    { 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfc, 0x10, 0x10, 0x10, 0x10, 0x10, },
    { 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0xf0, 0x10, 0x10, 0x10, 0x10, 0x10, },
    { 0x00, 0x10, 0x38, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x00, 0x00, },
    { 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x1c, 0x10, 0x10, 0x10, 0x10, 0x10, },
    { 0x00, 0x00, 0x00, 0x00, 0x08, 0x7c, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x00, 0x20, 0x7c, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, },
    { 0x00, 0x00, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x00, 0x20, 0x00, 0x00, },
    { 0x00, 0x28, 0x50, 0x50, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, },
    { 0x00, 0x00, 0x28, 0x28, 0xfc, 0x28, 0x50, 0xfc, 0x50, 0x50, 0x00, 0x00, },
    { 0x00, 0x20, 0x78, 0xa8, 0xa0, 0x60, 0x30, 0x28, 0xa8, 0xf0, 0x20, 0x00, },
    { 0x00, 0x00, 0x48, 0xa8, 0xb0, 0x50, 0x28, 0x34, 0x54, 0x48, 0x00, 0x00, },
    { 0x00, 0x00, 0x20, 0x50, 0x50, 0x78, 0xa8, 0xa8, 0x90, 0x6c, 0x00, 0x00, },
    { 0x00, 0x40, 0x40, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, },
    { 0x00, 0x04, 0x08, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x08, 0x04, 0x00, },
    { 0x00, 0x40, 0x20, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x20, 0x40, 0x00, },
    { 0x00, 0x00, 0x00, 0x20, 0xa8, 0x70, 0x70, 0xa8, 0x20, 0x00, 0x00, 0x00, },
    { 0x00, 0x00, 0x20, 0x20, 0x20, 0xf8, 0x20, 0x20, 0x20, 0x00, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x40, 0x80, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, },
    { 0x00, 0x08, 0x10, 0x10, 0x10, 0x20, 0x20, 0x40, 0x40, 0x40, 0x80, 0x00, },
    { 0x00, 0x00, 0x70, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x70, 0x00, 0x00, },
    { 0x00, 0x00, 0x20, 0x60, 0x20, 0x20, 0x20, 0x20, 0x20, 0x70, 0x00, 0x00, },
    { 0x00, 0x00, 0x70, 0x88, 0x88, 0x10, 0x20, 0x40, 0x80, 0xf8, 0x00, 0x00, },
    { 0x00, 0x00, 0x70, 0x88, 0x08, 0x30, 0x08, 0x08, 0x88, 0x70, 0x00, 0x00, },
    { 0x00, 0x00, 0x10, 0x30, 0x50, 0x50, 0x90, 0x78, 0x10, 0x18, 0x00, 0x00, },
    { 0x00, 0x00, 0xf8, 0x80, 0x80, 0xf0, 0x08, 0x08, 0x88, 0x70, 0x00, 0x00, },
    { 0x00, 0x00, 0x70, 0x90, 0x80, 0xf0, 0x88, 0x88, 0x88, 0x70, 0x00, 0x00, },
    { 0x00, 0x00, 0xf8, 0x90, 0x10, 0x20, 0x20, 0x20, 0x20, 0x20, 0x00, 0x00, },
    { 0x00, 0x00, 0x70, 0x88, 0x88, 0x70, 0x88, 0x88, 0x88, 0x70, 0x00, 0x00, },
    { 0x00, 0x00, 0x70, 0x88, 0x88, 0x88, 0x78, 0x08, 0x48, 0x70, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x20, 0x20, 0x00, },
    { 0x00, 0x04, 0x08, 0x10, 0x20, 0x40, 0x20, 0x10, 0x08, 0x04, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x00, 0xf8, 0x00, 0x00, 0xf8, 0x00, 0x00, 0x00, 0x00, },
    { 0x00, 0x40, 0x20, 0x10, 0x08, 0x04, 0x08, 0x10, 0x20, 0x40, 0x00, 0x00, },
    { 0x00, 0x00, 0x70, 0x88, 0x88, 0x10, 0x20, 0x20, 0x00, 0x20, 0x00, 0x00, },
    { 0x00, 0x00, 0x70, 0x88, 0x98, 0xa8, 0xa8, 0xb8, 0x80, 0x78, 0x00, 0x00, },
    { 0x00, 0x00, 0x20, 0x20, 0x30, 0x50, 0x50, 0x78, 0x48, 0xcc, 0x00, 0x00, },
    { 0x00, 0x00, 0xf0, 0x48, 0x48, 0x70, 0x48, 0x48, 0x48, 0xf0, 0x00, 0x00, },
    { 0x00, 0x00, 0x78, 0x88, 0x80, 0x80, 0x80, 0x80, 0x88, 0x70, 0x00, 0x00, },
    { 0x00, 0x00, 0xf0, 0x48, 0x48, 0x48, 0x48, 0x48, 0x48, 0xf0, 0x00, 0x00, },
    { 0x00, 0x00, 0xf8, 0x48, 0x50, 0x70, 0x50, 0x40, 0x48, 0xf8, 0x00, 0x00, },
    { 0x00, 0x00, 0xf8, 0x48, 0x50, 0x70, 0x50, 0x40, 0x40, 0xe0, 0x00, 0x00, },
    { 0x00, 0x00, 0x38, 0x48, 0x80, 0x80, 0x9c, 0x88, 0x48, 0x30, 0x00, 0x00, },
    { 0x00, 0x00, 0xcc, 0x48, 0x48, 0x78, 0x48, 0x48, 0x48, 0xcc, 0x00, 0x00, },
    { 0x00, 0x00, 0xf8, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0xf8, 0x00, 0x00, },
    { 0x00, 0x00, 0x7c, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x90, 0xe0, 0x00, },
    { 0x00, 0x00, 0xec, 0x48, 0x50, 0x60, 0x50, 0x50, 0x48, 0xec, 0x00, 0x00, },
    { 0x00, 0x00, 0xe0, 0x40, 0x40, 0x40, 0x40, 0x40, 0x44, 0xfc, 0x00, 0x00, },
    { 0x00, 0x00, 0xd8, 0xd8, 0xd8, 0xd8, 0xa8, 0xa8, 0xa8, 0xa8, 0x00, 0x00, },
    { 0x00, 0x00, 0xdc, 0x48, 0x68, 0x68, 0x58, 0x58, 0x48, 0xe8, 0x00, 0x00, },
    { 0x00, 0x00, 0x70, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x70, 0x00, 0x00, },
    { 0x00, 0x00, 0xf0, 0x48, 0x48, 0x70, 0x40, 0x40, 0x40, 0xe0, 0x00, 0x00, },
    { 0x00, 0x00, 0x70, 0x88, 0x88, 0x88, 0x88, 0xe8, 0x98, 0x70, 0x18, 0x00, },
    { 0x00, 0x00, 0xf0, 0x48, 0x48, 0x70, 0x50, 0x48, 0x48, 0xec, 0x00, 0x00, },
    { 0x00, 0x00, 0x78, 0x88, 0x80, 0x60, 0x10, 0x08, 0x88, 0xf0, 0x00, 0x00, },
    { 0x00, 0x00, 0xf8, 0xa8, 0x20, 0x20, 0x20, 0x20, 0x20, 0x70, 0x00, 0x00, },
    { 0x00, 0x00, 0xcc, 0x48, 0x48, 0x48, 0x48, 0x48, 0x48, 0x30, 0x00, 0x00, },
    { 0x00, 0x00, 0xcc, 0x48, 0x48, 0x50, 0x50, 0x30, 0x20, 0x20, 0x00, 0x00, },
    { 0x00, 0x00, 0xa8, 0xa8, 0xa8, 0x70, 0x50, 0x50, 0x50, 0x50, 0x00, 0x00, },
    { 0x00, 0x00, 0xd8, 0x50, 0x50, 0x20, 0x20, 0x50, 0x50, 0xd8, 0x00, 0x00, },
    { 0x00, 0x00, 0xd8, 0x50, 0x50, 0x20, 0x20, 0x20, 0x20, 0x70, 0x00, 0x00, },
    { 0x00, 0x00, 0xf8, 0x90, 0x10, 0x20, 0x20, 0x40, 0x48, 0xf8, 0x00, 0x00, },
    { 0x00, 0x38, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x38, 0x00, },
    { 0x00, 0x40, 0x40, 0x40, 0x20, 0x20, 0x10, 0x10, 0x10, 0x08, 0x00, 0x00, },
    { 0x00, 0x70, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x70, 0x00, },
    { 0x00, 0x20, 0x50, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfc, },
    { 0x00, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x48, 0x38, 0x48, 0x3c, 0x00, 0x00, },
    { 0x00, 0x00, 0xc0, 0x40, 0x40, 0x70, 0x48, 0x48, 0x48, 0x70, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x38, 0x48, 0x40, 0x40, 0x38, 0x00, 0x00, },
    { 0x00, 0x00, 0x18, 0x08, 0x08, 0x38, 0x48, 0x48, 0x48, 0x3c, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x48, 0x78, 0x40, 0x38, 0x00, 0x00, },
    { 0x00, 0x00, 0x1c, 0x20, 0x20, 0x78, 0x20, 0x20, 0x20, 0x78, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x3c, 0x48, 0x30, 0x40, 0x78, 0x44, 0x38, },
    { 0x00, 0x00, 0xc0, 0x40, 0x40, 0x70, 0x48, 0x48, 0x48, 0xec, 0x00, 0x00, },
    { 0x00, 0x00, 0x20, 0x00, 0x00, 0x60, 0x20, 0x20, 0x20, 0x70, 0x00, 0x00, },
    { 0x00, 0x00, 0x10, 0x00, 0x00, 0x30, 0x10, 0x10, 0x10, 0x10, 0x10, 0xe0, },
    { 0x00, 0x00, 0xc0, 0x40, 0x40, 0x5c, 0x50, 0x70, 0x48, 0xec, 0x00, 0x00, },
    { 0x00, 0x00, 0xe0, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0xf8, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xa8, 0xa8, 0xa8, 0xa8, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x48, 0x48, 0x48, 0xec, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x48, 0x48, 0x48, 0x30, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x48, 0x48, 0x48, 0x70, 0x40, 0xe0, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x38, 0x48, 0x48, 0x48, 0x38, 0x08, 0x1c, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0xd8, 0x60, 0x40, 0x40, 0xe0, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x78, 0x40, 0x30, 0x08, 0x78, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x20, 0x20, 0x70, 0x20, 0x20, 0x20, 0x18, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0xd8, 0x48, 0x48, 0x48, 0x3c, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0xec, 0x48, 0x50, 0x30, 0x20, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0xa8, 0xa8, 0x70, 0x50, 0x50, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0xd8, 0x50, 0x20, 0x50, 0xd8, 0x00, 0x00, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0xec, 0x48, 0x50, 0x30, 0x20, 0x20, 0xc0, },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x78, 0x10, 0x20, 0x20, 0x78, 0x00, 0x00, },
    { 0x00, 0x18, 0x10, 0x10, 0x10, 0x20, 0x10, 0x10, 0x10, 0x10, 0x18, 0x00, },
    { 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, },
    { 0x00, 0x60, 0x20, 0x20, 0x20, 0x10, 0x20, 0x20, 0x20, 0x20, 0x60, 0x00, },
    { 0x40, 0xa4, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, },
};

static struct chinese_bitmap {
    unsigned int char_code;
    unsigned short bitmap[12];

public:
    inline bool operator<(unsigned int _char_code)
    {
        return char_code < _char_code;
    }
} g_chinese_bitmap[] = {
    // #define NO_CHINESE_BITMAP
    #ifndef NO_CHINESE_BITMAP
    #   include "tfont_chinese_bitmap.h"
    #endif
};

double tfont_simple::height(void) const
{
    return 14;
}

double tfont_simple::emheight(void) const
{
    return 12;
}

const bitmap* tfont_simple::get_bitmap(unsigned int char_code) const
{
    if (char_code < sizeof(g_ascii_bitmap) / sizeof(*g_ascii_bitmap))
    {
        static bitmap bitmap = {
            .left       = 0,
            .top        = 0,
            .width      = 6,
            .height     = 12,
            .advance    = 6,
            .pitch      = 1,
            .pixel_mode = bitmap::pmMono,
        };

        bitmap.buffer = g_ascii_bitmap[char_code];

        return &bitmap;
    }
    else
    {
        static constexpr unsigned int kChineseBitmapCount =
            sizeof(g_chinese_bitmap) / sizeof(*g_chinese_bitmap);
        static chinese_bitmap* begin = &g_chinese_bitmap[0];
        static chinese_bitmap* end   = &g_chinese_bitmap[kChineseBitmapCount];

        chinese_bitmap* cb = std::lower_bound(begin, end, char_code);
        if (cb == end || cb->char_code != char_code)
            return get_bitmap(0);

        static bitmap bitmap = {
            .left       = 0,
            .top        = 0,
            .width      = 12,
            .height     = 12,
            .advance    = 12,
            .pitch      = 2,
            .pixel_mode = bitmap::pmMono,
        };

        bitmap.buffer = reinterpret_cast<unsigned char*>(cb->bitmap);

        return &bitmap;
    }
}

const tfont_simple* tfont_simple::get(void)
{
    static tfont_simple tfont;

    return &tfont;
}
